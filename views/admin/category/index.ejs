<!-- views/admin/category/index.ejs -->
    <div class="row">
        <div class="col-md-6">
            <h1>Categories</h1>
            <ul class="list-group" id="categoriesList">
                <% categories.forEach(category=> { %>
                    <li class="list-group-item" id="category-<%= category.id %>">
                        <!-- Display Mode -->
                        <div class="d-flex align-items-center justify-content-between display-mode">
                            <strong>
                                <%= category.name %>
                            </strong>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-primary rounded-circle" type="button"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-three-dots"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li>
                                        <button class="dropdown-item fw-semibold edit-btn" data-id="<%= category.id %>"
                                            data-name="<%= category.name %>">
                                            <i class="bi bi-pencil me-2 text-primary"></i>
                                            Edit
                                        </button>
                                    </li>
                                    <li>
                                        <form action="/admin/categories/<%= category.id %>/delete" method="POST"
                                            onsubmit="return confirm('Are you sure you want to delete this category?');">
                                            <button type="submit" class="dropdown-item text-danger fw-semibold">
                                                <i class="bi bi-trash me-2"></i>
                                                Delete
                                            </button>
                                        </form>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Edit Mode (Hidden by default) -->
                        <form class="edit-form d-none" id="edit-form-<%= category.id %>" data-id="<%= category.id %>">
                            <div class="d-flex align-items-center">
                                <input type="text" name="name" class="form-control form-control-sm me-2"
                                    value="<%= category.name %>" required>
                                <button type="submit" class="btn btn-success btn-sm me-1">
                                    <i class="bi bi-check"></i>
                                </button>
                                <button type="button" class="btn btn-danger btn-sm cancel-edit"
                                    data-id="<%= category.id %>">
                                    <i class="bi bi-x"></i>
                                </button>
                            </div>
                        </form>
                    </li>
                    <% }) %>
            </ul>
        </div>
        <div class="col-md-6">
            <h1>New Category</h1>
            <form action="/admin/categories/create" method="POST" class="d-flex mb-3">
                <input type="text" name="name" class="form-control me-2" placeholder="New Category Name" required>
                <button type="submit" class="btn btn-primary">Create</button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const categoriesList = document.getElementById('categoriesList');

            // Edit button click handler
            categoriesList.addEventListener('click', function (e) {
                if (e.target.closest('.edit-btn')) {
                    const editBtn = e.target.closest('.edit-btn');
                    const categoryId = editBtn.getAttribute('data-id');
                    const categoryName = editBtn.getAttribute('data-name');

                    // Show edit form, hide display
                    const listItem = document.getElementById(`category-${categoryId}`);
                    const displayMode = listItem.querySelector('.display-mode');
                    const editForm = listItem.querySelector('.edit-form');

                    displayMode.classList.add('d-none');
                    editForm.classList.remove('d-none');

                    // Focus on input
                    const input = editForm.querySelector('input[name="name"]');
                    input.focus();
                    input.select();
                }

                // Cancel edit button click
                if (e.target.closest('.cancel-edit')) {
                    const cancelBtn = e.target.closest('.cancel-edit');
                    const categoryId = cancelBtn.getAttribute('data-id');

                    const listItem = document.getElementById(`category-${categoryId}`);
                    const displayMode = listItem.querySelector('.display-mode');
                    const editForm = listItem.querySelector('.edit-form');

                    editForm.classList.add('d-none');
                    displayMode.classList.remove('d-none');
                }
            });

            // Edit form submission
            categoriesList.addEventListener('submit', function (e) {
                if (e.target.closest('.edit-form')) {
                    e.preventDefault();

                    const editForm = e.target.closest('.edit-form');
                    const categoryId = editForm.getAttribute('data-id');
                    const categoryName = editForm.querySelector('input[name="name"]').value.trim();

                    if (!categoryName) {
                        alert('Category name cannot be empty');
                        return;
                    }

                    // Send update request
                    fetch(`/admin/categories/${categoryId}/update`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            name: categoryName
                        })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                // Update display
                                const listItem = document.getElementById(`category-${categoryId}`);
                                const displayText = listItem.querySelector('.display-mode strong');
                                const editBtn = listItem.querySelector('.edit-btn');

                                displayText.textContent = categoryName;
                                editBtn.setAttribute('data-name', categoryName);

                                // Switch back to display mode
                                const displayMode = listItem.querySelector('.display-mode');
                                const editForm = listItem.querySelector('.edit-form');

                                editForm.classList.add('d-none');
                                displayMode.classList.remove('d-none');

                                // Show success message
                                showAlert('Category updated successfully!', 'success');
                            } else {
                                showAlert(data.error || 'Failed to update category', 'danger');
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            showAlert('An error occurred. Please try again.', 'danger');
                        });
                }
            });

            // Helper function to show alerts
            function showAlert(message, type) {
                // Remove existing alerts
                const existingAlert = document.querySelector('.alert');
                if (existingAlert) {
                    existingAlert.remove();
                }

                // Create alert
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type} alert-dismissible fade show mt-3`;
                alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;

                // Insert after page title
                const title = document.querySelector('h1');
                title.parentNode.insertBefore(alertDiv, title.nextSibling);

                // Auto dismiss after 3 seconds
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.remove();
                    }
                }, 3000);
            }
        });
    </script>

    <style>
        .list-group-item {
            transition: all 0.3s ease;
        }

        .list-group-item:hover {
            background-color: #f8f9fa;
        }

        .edit-form input {
            flex: 1;
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }

        .alert {
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>